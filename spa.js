let state = {
    name: 'Mohammed',
    stockdata: {
        type: 'table',
        headers: ['Code', 'Open', 'Close', 'Indicator1', 'Ind2'],
        elements: [],
        data: [[309,96.56,100.72,99.87,102.03],[6606,59.87,54.5,54.35,68.89],[8892,6.13,2.58,1.7,4.87],[1772,6.04,-3.58,15.1,7.25],[9665,72.12,70.66,81.77,63.21],[1398,83.9,82.73,75.11,79.83],[3326,30.07,38.77,33.75,25.41],[444,7.39,2.13,8.22,15.62],[4464,47.46,56.17,44.36,45.21],[7953,83.83,89.71,87.07,88.61],[6961,28.81,25.93,26.56,38.44],[2500,53.07,62.93,52.43,57.34],[5873,84.11,76.66,86.33,93.43],[9988,27.05,22.77,25.94,29.33],[7350,62.55,53.95,68.8,65.88],[5372,54.43,55.46,58.58,58.65],[4365,51.3,58.38,57.73,51.43],[6904,50.15,52.83,42.09,51.74],[9033,33.44,33.75,28,32.42],[8868,96.07,94.01,92.75,95.87],[8990,35.86,35.95,27.63,38.96],[4664,84.96,78.67,86.51,94.66],[9346,13.83,8.55,23.03,13.17],[790,12.01,10.93,12.84,12.96],[9535,22.11,31.52,19.41,17.81],[2368,73.05,72.69,81.8,65.36],[260,29.34,32.57,31.58,31.4],[5089,46.31,46.97,43.47,44.06],[1727,99.23,90.61,105.07,97.23],[7244,21.06,17.04,21.56,26.55],[6630,28.67,31.66,37.47,29.56],[9835,11.96,4.28,13.92,18.23],[5673,13.86,21.61,9.72,4.61],[8124,45.95,37.67,49.34,36.62],[7513,66.38,60.79,73.07,65.14],[5213,65.87,59.21,56.95,61.95],[8110,95.76,95.56,91.98,102.46],[9699,82.46,86.86,89.01,77.96],[1147,55.94,47.46,49.95,60.64],[4292,98.46,95.29,92.37,104.85],[7416,66.2,63.43,57.2,75.56],[8275,5.07,5.22,1.56,13.01],[958,9.19,2.04,8.79,8.94],[7066,79.55,80.08,70.78,81.86],[2044,81.95,79.19,79.19,82.58],[6732,30.45,34.89,23.86,35.6],[6272,35.82,35.23,32.27,29.57],[3928,77.19,68.22,77.87,71.07],[1869,22.78,31.77,15.69,14.48],[1240,16.22,21.84,9.8,16.72],[8646,76.01,66.04,77.83,71.77],[5318,2.59,3.81,-4.89,6.86],[6379,56.3,50.12,63.4,62.11],[1735,66.54,64.72,60.74,60.28],[2945,8.31,-0.86,15.01,1.07],[9882,70.26,68.56,72.55,68.19],[1561,69.63,61.33,61.27,71.26],[9080,73.56,72.94,76.25,76.12],[1120,70.92,78.63,62.86,68.38],[7316,4.61,6.78,-3.56,0.83],[3966,14.21,4.38,22.51,19.16],[556,9.15,16.8,12.35,3.02],[400,61.47,52.53,58.99,68.68],[3734,41.87,44.14,49.5,45.37],[6619,45.44,42.43,49.28,55.22],[2270,54.71,55.44,47.76,58.33],[4925,11.92,2.83,18.78,10.9],[2607,81.58,76.01,80.62,73.77],[4188,97.31,106.55,91.42,96.63],[1562,85.61,79.65,81.2,82.31],[9411,49.04,47.13,47.91,39.17],[5757,46.29,36.4,54.3,50.1],[7742,63.06,69.34,54.54,60.71],[1136,17.51,16.58,23.69,12.49],[3032,20.98,17.59,11.1,18.38],[7062,98.14,92.68,102.16,95.81],[102,41.12,44.99,48.21,33.88],[453,30.99,38.28,40.43,25.58],[201,64.08,62.74,54.33,65.14],[7508,33.1,24.63,40.61,32.94],[7585,54.21,51.4,47.02,59.6],[1778,97.88,97.38,90.03,88.47],[8303,84.75,76.54,75.72,81.21],[7678,4.31,8.08,8.39,7.87],[5999,26.09,21.88,24.01,20.57],[9488,28.61,32.65,18.65,24.53],[1299,90.75,95.04,86.61,92.73],[7528,84.92,79.04,85.8,76.96],[351,32.48,36.47,36.94,36.4],[1130,52.74,56.85,60.42,45.46],[3595,26.85,35.94,30.94,31.28],[5363,3.07,-1.81,4.69,12.59],[1071,56.41,50.08,49.37,64.96],[7472,42.42,45.91,47.5,46.36],[5478,80.32,89.36,81.95,81.59],[8190,22.39,15.86,31.74,28.53],[7107,8.33,0.74,3.76,11.45],[796,4.09,12.98,-0.72,11.21],[1783,34.2,35.68,40.41,32.22],[9057,51.08,50.53,42.02,43.85],[8358,37.07,37.64,33.25,32.68],[3899,98.03,92.27,102.66,99.98],[4655,54.84,47.46,49.87,50.68],[8969,87.73,90.27,90.46,85.34],[3677,97.96,96.02,92.96,97.7],[5252,41.07,47.08,40.38,36.16],[2911,33.22,27.08,40.26,42.98],[836,96.12,89.11,87.09,97.98],[9625,94.31,88.99,86.89,104.12],[5365,6.12,8.6,10.37,3.82],[7658,9.05,3.35,9.83,1.59],[991,29.51,24.08,28.78,26.43],[1816,0.66,-2.78,1.86,-7.94],[8404,53.12,56.9,55.04,44.85],[9902,52.52,60.06,61.65,59.52],[3707,6.28,2.44,0.76,15.5],[2472,30.01,35.61,34.24,29.05],[5850,23.79,31.12,22.4,18.05],[9948,10.19,8.47,5.96,10.21],[4452,24.55,17.57,23.23,28.93],[5276,2.85,2.28,-7.03,-1.39],[7941,26.72,26.33,16.83,35.66],[5586,78.06,80.71,87.87,78.11],[796,19.73,13.73,29.71,28.2],[3019,55.4,51.14,53.09,57.44],[9147,12.52,16.8,5.41,2.77],[677,38.95,42.52,32.3,36.84],[5694,75.25,84.62,84.36,74.83],[9891,34.73,29.04,34.7,35.88],[3445,52.1,61.86,62.05,45.11],[4204,68.4,71.22,71.74,73.22],[2021,32.12,39.43,29.32,25.72],[2297,82.68,78.46,91.42,86.18],[9004,0.16,0.63,9.51,-6.41],[5569,81.66,72.45,82.77,85.44],[5352,92.55,90.87,91.42,93.73],[6189,13.5,5.72,3.91,13.65],[9385,27.34,32.09,20.39,34.78],[3515,28.49,28.63,31.09,30.07],[7999,34.2,28.88,35.58,42.15],[5009,6.57,5.76,7.72,13.78],[8354,92.27,97.07,93.53,87.07],[7068,64.36,67.84,73.89,67.81],[239,14.75,5.74,19.15,24.64],[4469,9.4,18.84,1.26,18.44],[25,93.12,103.12,89.99,100.35],[5335,59.67,50.55,51.58,59.53],[6053,18.36,24.49,13.27,27.24],[1100,92.87,92.64,93.22,98.28],[9223,85.06,77.59,91.56,94.36],[991,96.25,88,95.28,98.93],[2581,8.58,9.53,3.93,9.21],[8944,30.18,28.31,26.94,36.97],[5846,23.69,31.28,19.71,28.24],[8157,81.37,80.28,73.32,75.56],[7338,54.55,57.69,50.41,60.12],[640,77.92,73.28,81.05,81.89],[1604,92.45,90.45,99.35,94.74],[718,35.93,36.79,26.8,28.84],[9464,35.76,40.23,36.71,35.54],[1028,0.84,3.38,7.49,-0.93],[3772,1.89,0.96,7.25,-6.1],[7729,98.42,108.27,92.4,98.32],[4811,37.01,44.31,44.5,32.86],[6693,28.28,24.16,21.37,27.9],[6890,76.18,70.43,73.77,77.33],[2558,98.91,108.07,94.55,93.29],[4994,59.56,68.8,67.54,61.71],[2955,48.84,52.69,58.2,52.92],[6872,83.74,86.5,76.72,92.72],[5924,68.24,73.73,63.85,58.58],[1131,63.08,68.04,56.55,58.43],[6967,15.34,14.56,17.48,11.04],[5993,63.33,56.18,67.65,71.62],[954,36.97,39.72,30.74,42.95],[5778,95.54,97.5,90.46,97.66],[2287,30.43,35.48,31.79,29.49],[3431,90.34,81.52,91.75,91.03],[7750,15.14,10.11,12.85,24.41],[2305,34.35,43.6,31.83,26.99],[9798,9.04,7.85,5.36,3.37],[8021,65.7,59.28,71.23,56.81],[9903,56.64,58.29,64.96,62.81],[8958,71.44,75.27,75,69.57],[8309,92.55,95.79,87.07,96.09],[785,48.84,46.03,53.6,49.29],[2947,91.01,100.53,86.73,86.58],[7980,82.11,90.31,79.31,84.81],[6410,50.81,46.82,45.62,53.97],[4012,92.13,91.2,93.79,90.21],[862,58.32,53.26,65.91,53.18],[9095,71.56,72.31,80.88,66.12],[2695,17.63,20.79,16.85,10.05],[6850,7.9,8.61,12.58,-0.25],[6253,68.81,70.91,69.89,62.57],[3544,51.97,47.59,51.25,45.91],[7243,14.58,9.1,23.11,19.99],[5220,26.98,32.37,32.38,36.89],[3828,19.1,12.58,24.86,26.84],[2663,90.4,83.71,94.37,95.18],[7609,14.5,12.88,18.36,15.2],[2305,90.51,82.46,95.25,97.17],[3141,13.74,16.05,5.14,5.46],[6070,63.44,55.66,65.5,61.63],[3099,81.21,77.94,90.36,74.88],[6396,41.29,43.25,49.61,43.21],[3411,84.62,80.55,77.85,84.13],[8410,96.66,104.27,100.72,98.41],[5786,30.17,39.57,37.51,30.91],[6858,47.75,53.51,48.77,38.97],[7839,41.11,34.49,38.81,33.8],[9497,69.82,73.08,70.76,76.46],[9089,13.9,19.38,11.35,7.71],[821,86.54,87.24,85.3,89.01],[1337,9.38,2.71,17.09,2.05],[7727,95.84,104.74,97.86,98.59],[3505,24.66,26.01,17.25,26.79],[3316,84.17,88.41,83.06,87.48],[9381,81.14,72.01,73.35,74.36],[4310,76.96,68.67,72.06,82.94],[5310,58.89,62.21,61.38,61.79],[7496,74.77,78.92,83.09,75.99],[9515,3.1,-6.18,-3.21,0.8],[2138,35.7,40.7,42.6,29.51],[898,80.82,78.08,80.57,75.91],[9063,31.07,30.05,24.42,27.02],[6587,92.18,89.57,100.69,82.69],[9618,97.31,97.31,90.12,102.5],[6588,51.75,53.45,43.55,54.31],[373,65.28,72.96,74.09,60.88],[5789,85.52,81.53,92.27,93.47],[1845,77.89,76.67,73.92,87.83],[5096,79.66,89.18,69.95,75.08],[292,27.27,21.71,33.19,19.15],[8556,27.17,23.47,21.23,31.01],[6915,68.97,60.39,73.4,61.82],[7899,90.69,99.07,91.9,85.45],[742,56.41,49.13,50.24,48.61],[6609,43.29,48.47,49.9,38.31],[1785,21.31,16.72,30.45,24.45],[6108,8.73,6.37,-1.15,10.06],[5142,40.72,43.23,46.89,39.15],[355,35.13,44.31,28.36,33.86],[5758,94.67,101.9,102.52,104.22],[452,36.73,33.48,40.68,32.38],[9321,51.19,57.65,52.49,60.5],[2603,32.15,28.15,24.08,36.29],[758,59.4,56.99,65.24,55.3],[1448,67.43,63.44,60.69,62.73],[3516,76.66,83.31,85.8,69.33],[1823,30.4,23.37,38.8,27.93],[3142,74.48,70.78,73.9,75.57],[4711,87.99,80.61,87.79,83.45],[2324,93.69,102.81,86.18,87.22],[3132,56.54,64.13,60.53,55.68],[6797,40.61,40.92,43.16,43.25],[960,62.38,58.6,63.04,67.1],[7722,52.82,44.64,60.04,48.27],[8585,95.19,91.18,96.41,85.79],[936,78.83,82.54,69.11,87.07],[7266,0.99,4.68,-1.99,-3.03],[2277,11.4,18.33,15.63,15.09],[316,66.27,56.77,66.08,75.74],[2643,11.23,11.01,6.17,4.93],[7998,57.61,61.84,57.09,55.26],[3394,45.12,50.36,40.49,51.94],[1306,42.58,48.26,48.24,50.42],[2186,58.84,65.03,56.49,54.05],[575,87.62,90.28,81.6,87.49],[3858,99.3,100.46,94.2,94.61],[3918,15.03,15.6,21.23,5.86],[6813,19.09,22.32,21.47,18.01],[3500,5.65,15.27,6.6,-3.58],[3239,52.61,57.2,49.33,43.74],[3679,47.95,40.63,50.43,53.15],[1965,11.62,12.93,3.07,13.44],[8471,44.4,47.01,44.76,54.36],[1328,70.04,70.56,65.9,77.91],[7199,29.29,29.31,21.85,19.99],[1464,25.34,21.3,28.98,15.8],[82,25.54,34.86,18.15,27.68],[4473,62.81,62.23,59.9,68.76],[938,33.22,24.61,33.83,25.46],[4910,11.06,12.04,10.57,15.24],[1387,92.77,101.25,90.22,91.17],[8279,26.19,24.6,25.59,17.65],[2258,37.22,31.46,40.01,38.88],[6022,70.18,73.42,71.21,79.08],[964,30.89,22.78,27.59,26.09],[1995,95.12,95.52,92.98,94.64],[1649,29.54,27.87,36.1,21.24],[628,1.07,6.35,-6.67,0.4],[5140,88.34,88.38,83.18,89.69],[9594,3.61,9.03,10.63,-5.7],[288,12.28,6.1,4.15,20.45],[2487,25.7,25.46,18.98,25.16],[6507,55.57,46.48,46.84,60.57],[157,83.59,78.28,81.06,85.03],[6600,27.44,37.2,36.37,28.09],[4981,60.72,52.11,66.01,63.39]]
    }
}
let elems = {}
elems["name"] = []
document.querySelectorAll('[data-state="name"]').forEach(it => {        
    elems["name"].push(it)
})

function changestate(el){
    state["name"] = el.value;
    for(let el of elems["name"]){
        el.innerText = state["name"];
    }
    localStorage.setItem("state",JSON.stringify(state));
}

function loadState(){
    for(let el of elems["name"]){
        el.innerText = state["name"];
    }

    for(let stateElKey of Object.keys(state)){
        switch(state[stateElKey].type){
            case "table":
                buildTables(stateElKey)
                break;
            case "text":
                break;
            default:
                break;
        }
    }
}

(function(){
    //state = JSON.parse(localStorage.getItem("state"))
    loadState()
})();

function buildTables(key){
    document.querySelectorAll('[data-datasource="' + key + '"]').forEach(it => {
        state[key].elements.push(it)
        let head = document.createElement('thead')        
        let hrow = document.createElement('tr')
        for(let head of state[key].headers){
            let th = document.createElement('th')
            th.innerText = head
            hrow.appendChild(th)
        }
        head.appendChild(hrow)

        let body = document.createElement('tbody')

        for(let entry of state[key].data){
            let row = document.createElement('tr')
            for(let element of entry){
                let td = document.createElement('td')
                td.innerText = element
                row.appendChild(td)
            }
            body.appendChild(row)
        }

        it.appendChild(head)
        it.appendChild(body)
        
    })
    
    reloadTable(key);
    setInterval(reloadData, 1000);
}

function reloadTable(key){
    for(let tag of state[key].elements){
        let tbody = tag.childNodes.item(1)
        //let tbody = document.getElementById();
        let data = state[key].data
        for(let i = 0 ; i < data.length ; i++){
            if(i >= tbody.childNodes.length){
                break  // create new row with new data...
            }
            let row = tbody.childNodes[i]
            for(let j = 1 ; j < data[i].length ; j++){
                row.childNodes[j].innerText = (+data[i][j]).toFixed(2);
            }
        }
    }
}

function reloadData(){
    for(let dat of state.stockdata.data){
        dat[1] = dat[1] + (Math.random() * (Math.random() > 0.5 ? 1 : -1));
        dat[2] = dat[2] + (Math.random() * (Math.random() > 0.5 ? 1 : -1));
        dat[3] = dat[3] + (Math.random() * (Math.random() > 0.5 ? 1 : -1));
        dat[4] = dat[4] + (Math.random() * (Math.random() > 0.5 ? 1 : -1));
    }
    reloadTable('stockdata');
}

